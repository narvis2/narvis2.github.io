<!DOCTYPE html><html lang="ko-KR" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Android ConnectivityManager를 통한 Network 관리" /><meta name="author" content="Narvis2" /><meta property="og:locale" content="ko_KR" /><meta name="description" content="안녕하세요. Narvis2 입니다. 오늘은 Android Network 관리에 대하여 알아보도록 하겠습니다. 실전 코드를 통하여 알아볼 것 이고 AndroidViewModel 를 사용하며 activityX 의 viewModels와 fragmentX activityViewModels를 통하여 Fragment의 상태를 공유하여 처리하는 코드입니다. Android에서는 ConnectivityManager를 통하여 연결 상태를 확인할 수 있습니다. Android에서는 셀룰러, 와이파이, 일반 네트워크(Default Network)가 존재하는데 기본으로 사용할 네트워크는 시스템에서 결정합니다. 아래에서 코드를 통해 알아보겠습니다." /><meta property="og:description" content="안녕하세요. Narvis2 입니다. 오늘은 Android Network 관리에 대하여 알아보도록 하겠습니다. 실전 코드를 통하여 알아볼 것 이고 AndroidViewModel 를 사용하며 activityX 의 viewModels와 fragmentX activityViewModels를 통하여 Fragment의 상태를 공유하여 처리하는 코드입니다. Android에서는 ConnectivityManager를 통하여 연결 상태를 확인할 수 있습니다. Android에서는 셀룰러, 와이파이, 일반 네트워크(Default Network)가 존재하는데 기본으로 사용할 네트워크는 시스템에서 결정합니다. 아래에서 코드를 통해 알아보겠습니다." /><link rel="canonical" href="https://narvis2.github.io/posts/Android-Network/" /><meta property="og:url" content="https://narvis2.github.io/posts/Android-Network/" /><meta property="og:site_name" content="Narvis2" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-18T09:08:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Android ConnectivityManager를 통한 Network 관리" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Narvis2"},"dateModified":"2022-07-18T12:01:20+09:00","datePublished":"2022-07-18T09:08:00+09:00","description":"안녕하세요. Narvis2 입니다. 오늘은 Android Network 관리에 대하여 알아보도록 하겠습니다. 실전 코드를 통하여 알아볼 것 이고 AndroidViewModel 를 사용하며 activityX 의 viewModels와 fragmentX activityViewModels를 통하여 Fragment의 상태를 공유하여 처리하는 코드입니다. Android에서는 ConnectivityManager를 통하여 연결 상태를 확인할 수 있습니다. Android에서는 셀룰러, 와이파이, 일반 네트워크(Default Network)가 존재하는데 기본으로 사용할 네트워크는 시스템에서 결정합니다. 아래에서 코드를 통해 알아보겠습니다.","headline":"Android ConnectivityManager를 통한 Network 관리","mainEntityOfPage":{"@type":"WebPage","@id":"https://narvis2.github.io/posts/Android-Network/"},"url":"https://narvis2.github.io/posts/Android-Network/"}</script><title>Android ConnectivityManager를 통한 Network 관리 | Narvis2</title><link rel="android-chrome-192x192" sizes="192x192" href="/assets/img/favicons/android-chrome-192x192.png"><link rel="android-chrome-512x512" sizes="512x512" href="/assets/img/favicons/android-chrome-512x512.png"><link rel="mstile-150x150" sizes="150x150" href="/assets/img/favicons/mstile-150x150.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Narvis2"><meta name="application-name" content="Narvis2"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/main.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Narvis2</a></div><div class="site-subtitle font-italic">개발 일지</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>홈</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>카테고리</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>태그</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>아카이브</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>정보</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/narvis2" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['narvis2','naver.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 홈 </a> </span> <span>Android ConnectivityManager를 통한 Network 관리</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 포스트</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="검색..."> </span> <span id="search-cancel" >취소</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Android ConnectivityManager를 통한 Network 관리</h1><div class="post-meta text-muted"> <span> 게시 <em class="" data-ts="1658102880" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-07-18 </em> </span> <span> 업데이트 <em class="" data-ts="1658113280" data-df="YYYY-MM-DD" data-toggle="tooltip" data-placement="bottom"> 2022-07-18 </em> </span><div class="d-flex justify-content-between"> <span> By <em> narvis2 </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3328 단어"> <em>18 분</em>읽는 시간</span></div></div></div><div class="post-content"><p>안녕하세요. Narvis2 입니다.<br /> 오늘은 Android Network 관리에 대하여 알아보도록 하겠습니다.<br /> 실전 코드를 통하여 알아볼 것 이고 AndroidViewModel 를 사용하며 activityX 의 viewModels와 fragmentX activityViewModels를 통하여 Fragment의 상태를 공유하여 처리하는 코드입니다.<br /> Android에서는 ConnectivityManager를 통하여 연결 상태를 확인할 수 있습니다.<br /> Android에서는 셀룰러, 와이파이, 일반 네트워크(Default Network)가 존재하는데 기본으로 사용할 네트워크는 시스템에서 결정합니다.<br /> 아래에서 코드를 통해 알아보겠습니다.</p><h2 id="1-androidviewmodel-을-사용한-network-관리"><span class="mr-2">1. AndroidViewModel 을 사용한 Network 관리</span><a href="#1-androidviewmodel-을-사용한-network-관리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Hilt + DataStore 를 기본으로 사용하겠습니다.<br /> DataStore은 셀룰러 on/off 유무를 저장하기 위해 사용하였으며, Hilt는 DataStore를 ViewModel의 생성자에 주입받기 위해 사용합니다.<br /> DataStore에 대하여 잘 모르시면 해당 링크를 참고하시길 권장 드립니다. -&gt; <a href="https://narvis2.github.io/posts/Android-DataStore/">DataStore 정리</a></p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
</pre><td class="rouge-code"><pre><span class="nd">@HiltViewModel</span> <span class="c1">// Hilt를 ViewModel에서 사용할 때는 해당 어노테이션을 달아주셔야 합니다.</span>
<span class="kd">class</span> <span class="nc">NetworkViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="n">application</span><span class="p">:</span> <span class="nc">Application</span><span class="p">,</span> 
    <span class="k">private</span> <span class="kd">val</span> <span class="py">dataStore</span><span class="p">:</span> <span class="nc">DataStoreModule</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">AndroidViewModel</span><span class="p">(</span><span class="n">application</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 해당 Enum Class를 바탕으로 DataBinding을 통해 UI 를 Controll 합니다.</span>
    <span class="k">enum</span> <span class="kd">class</span> <span class="nc">NetworkStatus</span> <span class="p">:</span> <span class="nc">EnumClassProguard</span> <span class="p">{</span>
        <span class="nc">CONNECT_ERROR</span><span class="p">,</span> <span class="nc">CONNECT_NETWORK</span><span class="p">,</span> <span class="nc">DISCONNECT_NETWORK</span><span class="p">,</span> <span class="nc">CONNECT_NETWORK_BUT_NOT_USE_MOBILE_DATA</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kd">var</span> <span class="py">manager</span><span class="p">:</span> <span class="nc">ConnectivityManager</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
    
    <span class="c1">// Network가 연결 되었는지 유무</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">isNetworkConn</span> <span class="p">=</span> <span class="k">false</span>
    <span class="c1">// Wifi 연결 유무</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">isWifiConn</span> <span class="p">=</span> <span class="k">false</span>
    <span class="c1">// Cellular 연결 유무</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">isCellularConn</span> <span class="p">=</span> <span class="k">false</span>

    <span class="c1">// 현재 네트워크 상태를 담고있는 LiveData, 해당 LiveData를 Activity/Fragment에서 Observing하여 Network 별 UI를 Controll 합니다.</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">_currentNetworkStatus</span> <span class="p">=</span> <span class="nc">MutableLiveData</span><span class="p">&lt;</span><span class="nc">NetworkStatus</span><span class="p">&gt;()</span>
    <span class="kd">val</span> <span class="py">currentNetworkStatus</span><span class="p">:</span> <span class="nc">LiveData</span><span class="p">&lt;</span><span class="nc">NetworkStatus</span><span class="p">&gt;</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">_currentNetworkStatus</span>
    
    <span class="c1">// DataBinding에서 사용될 StateFlow 입니다.</span>
    <span class="c1">// StateFlow는 초기값이 항상 필요하며, StateFlow는 중복값을 무시하고 .value를 통해 현재 값을 가져올 수 있습니다.(양방향 Observing)</span>
    <span class="kd">val</span> <span class="py">networkStatus</span> <span class="p">=</span> <span class="nc">MutableStateFlow</span><span class="p">(</span><span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_ERROR</span><span class="p">)</span>

    <span class="c1">// Mobile Data 즉 Cellular 연결을 체크할지 유무입니다.</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">checkMobileData</span> <span class="p">=</span> <span class="k">false</span>

    <span class="c1">// Network 가 연결되었을 경우, 연결되어있지 않을 경우를 Boolean으로 구분하여 처리합니다.</span>
    <span class="c1">// Coroutine Channel 은 정확히 한 번만 처리해야하는 Event를 처리하는데 사용됩니다. (단방향 Observing)</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">_networkAction</span> <span class="p">=</span> <span class="nc">Channel</span><span class="p">&lt;</span><span class="nc">Boolean</span><span class="p">&gt;(</span><span class="nc">Channel</span><span class="p">.</span><span class="nc">CONFLATED</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">networkAction</span> <span class="p">=</span> <span class="n">_networkAction</span><span class="p">.</span><span class="nf">receiveAsFlow</span><span class="p">()</span>

    <span class="c1">// Wifi를 담당하는 NetworkCallback 입니다.</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">wifiNetworkCallback</span> <span class="p">=</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">ConnectivityManager</span><span class="p">.</span><span class="nc">NetworkCallback</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// 연결된 경우</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onAvailable</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="nf">onAvailable</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">isWifiConn</span> <span class="p">=</span> <span class="k">true</span>
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1">// 연결 끊긴 경우</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onLost</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="nf">onLost</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">isWifiConn</span> <span class="p">=</span> <span class="k">false</span>
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Cellular를 담당하는 NetworkCallback 입니다.</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">cellularNetworkCallback</span> <span class="p">=</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">ConnectivityManager</span><span class="p">.</span><span class="nc">NetworkCallback</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onAvailable</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="nf">onAvailable</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">isCellularConn</span> <span class="p">=</span> <span class="k">true</span>
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onLost</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="nf">onLost</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">isCellularConn</span> <span class="p">=</span> <span class="k">false</span>
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Default Network를 담당하는 NetworkCallback 입니다.</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">defaultNetworkCallback</span> <span class="p">=</span> <span class="kd">object</span> <span class="err">: </span><span class="nc">ConnectivityManager</span><span class="p">.</span><span class="nc">NetworkCallback</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onAvailable</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="nf">onAvailable</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">isNetworkConn</span> <span class="p">=</span> <span class="k">true</span>
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">override</span> <span class="k">fun</span> <span class="nf">onLost</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">super</span><span class="p">.</span><span class="nf">onLost</span><span class="p">(</span><span class="n">network</span><span class="p">)</span>
            <span class="n">isNetworkConn</span> <span class="p">=</span> <span class="k">false</span>
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 네트워크 상태를 바꿔주는 함수 입니다.</span>
    <span class="k">fun</span> <span class="nf">changeNetworkStatus</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
        <span class="c1">// 모바일 데이터 사용 유무를 DataStore에서 가져옵니다.</span>
        <span class="kd">val</span> <span class="py">isDataConn</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">.</span><span class="n">getUserMobileData</span><span class="p">.</span><span class="nf">first</span><span class="p">()</span>
        <span class="n">networkStatus</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
            <span class="c1">// 네트워크가 연결된 경우</span>
            <span class="n">isNetworkConn</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">isWifiConn</span> <span class="p">||</span> <span class="p">!</span><span class="n">checkMobileData</span> <span class="p">||</span> <span class="p">(</span><span class="n">isDataConn</span> <span class="p">&amp;&amp;</span> <span class="n">isCellularConn</span><span class="p">))</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_NETWORK</span>
            <span class="p">}</span>
            <span class="c1">// 네트워크가 연결되어있지만 셀룰러를 사용하지 않는 경우</span>
            <span class="n">isNetworkConn</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">isDataConn</span> <span class="p">&amp;&amp;</span> <span class="n">isCellularConn</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_NETWORK_BUT_NOT_USE_MOBILE_DATA</span>
            <span class="p">}</span>
            <span class="c1">// 나머지의 경우</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">DISCONNECT_NETWORK</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">networkStatus</span><span class="p">.</span><span class="n">value</span> <span class="p">!=</span> <span class="n">currentNetworkStatus</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">_currentNetworkStatus</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">networkStatus</span><span class="p">.</span><span class="n">value</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 네트워크 Callback을 등록할 때 사용하는 함수 입니다.</span>
    <span class="k">fun</span> <span class="nf">register</span><span class="p">(</span><span class="n">checkMobileData</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="n">checkNetworkStatus</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">checkMobileData</span> <span class="p">=</span> <span class="n">checkMobileData</span>
        <span class="n">manager</span> <span class="p">=</span>
            <span class="n">application</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="nc">Context</span><span class="p">.</span><span class="nc">CONNECTIVITY_SERVICE</span><span class="p">)</span> <span class="k">as</span> <span class="nc">ConnectivityManager</span>
        <span class="c1">// Android Version이 24보다 클 경우 DefaultNetwork 사용</span>
        <span class="k">if</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION</span><span class="p">.</span><span class="nc">SDK_INT</span> <span class="p">&gt;=</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">N</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">registerDefaultNetwork</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">isNetworkConn</span> <span class="p">=</span> <span class="k">true</span>
        <span class="p">}</span>
        <span class="c1">// Wifi Network Callback 등록</span>
        <span class="nf">registerWifi</span><span class="p">()</span>
        <span class="c1">// Cellular Network Callback 등록</span>
        <span class="nf">registerCellular</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">checkNetworkStatus</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 버전 관리 SDK_INT 23 이상부터는 activeNetworkInfo 는 Deprecated 됨</span>
            <span class="k">if</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION</span><span class="p">.</span><span class="nc">SDK_INT</span> <span class="p">&gt;=</span> <span class="mi">23</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">checkActiveNetwork</span><span class="p">()</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">checkActiveNetworkInfo</span><span class="p">()</span>
            <span class="p">}</span>
            
            <span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 네트워크 Callback을 해제할 때 사용하는 함수 입니다.</span>
    <span class="k">fun</span> <span class="nf">unRegister</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION</span><span class="p">.</span><span class="nc">SDK_INT</span> <span class="p">&gt;=</span> <span class="nc">Build</span><span class="p">.</span><span class="nc">VERSION_CODES</span><span class="p">.</span><span class="nc">N</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">unRegisterDefaultNetwork</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nf">unRegisterWifi</span><span class="p">()</span>
        <span class="nf">unRegisterCellular</span><span class="p">()</span>
        <span class="n">manager</span> <span class="p">=</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="c1">// 활성화된 Network 정보를 가져오는 함수 입니다. SDK_INT 23 이상부터는 activeNetwork 를 통하여 가져옵니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">checkActiveNetwork</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="n">activeNetwork</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="n">isNetworkConn</span> <span class="p">=</span> <span class="k">true</span>
            <span class="n">isWifiConn</span> <span class="p">=</span> <span class="nf">hasTransport</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nc">NetworkCapabilities</span><span class="p">.</span><span class="nc">TRANSPORT_WIFI</span><span class="p">)</span>
            <span class="n">isCellularConn</span> <span class="p">=</span> <span class="nf">hasTransport</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="nc">NetworkCapabilities</span><span class="p">.</span><span class="nc">TRANSPORT_CELLULAR</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">hasTransport</span><span class="p">(</span><span class="n">network</span><span class="p">:</span> <span class="nc">Network</span><span class="p">,</span> <span class="n">transport</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">getNetworkCapabilities</span><span class="p">(</span><span class="n">network</span><span class="p">)</span><span class="o">?.</span><span class="nf">hasTransport</span><span class="p">(</span><span class="n">transport</span><span class="p">)</span> <span class="o">?:</span> <span class="k">false</span>

    <span class="c1">// 활성화된 Network 정보를 가져오는 함수 입니다. SDK_INT 23 이하에서는 activeNetworkInfo 를 통하여 가져옵니다.</span>
    <span class="nd">@Suppress</span><span class="p">(</span><span class="s">"DEPRECATION"</span><span class="p">)</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">checkActiveNetworkInfo</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="n">activeNetworkInfo</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">isConnectedOrConnecting</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">isNetworkConn</span> <span class="p">=</span> <span class="k">true</span>
                <span class="n">isWifiConn</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">type</span> <span class="p">==</span> <span class="nc">ConnectivityManager</span><span class="p">.</span><span class="nc">TYPE_WIFI</span>
                <span class="n">isCellularConn</span> <span class="p">=</span> <span class="n">it</span><span class="p">.</span><span class="n">type</span> <span class="p">==</span> <span class="nc">ConnectivityManager</span><span class="p">.</span><span class="nc">TYPE_MOBILE</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// WIFI Callback을 등록하는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">registerWifi</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">registerNetworkCallback</span><span class="p">(</span>
            <span class="nf">createNetworkRequest</span><span class="p">(</span><span class="nc">NetworkCapabilities</span><span class="p">.</span><span class="nc">TRANSPORT_WIFI</span><span class="p">),</span>
            <span class="n">wifiNetworkCallback</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// WIFI Callback을 해제하는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">unRegisterWifi</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">unregisterNetworkCallback</span><span class="p">(</span><span class="n">wifiNetworkCallback</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Cellular Callback을 등록하는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">registerCellular</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">registerNetworkCallback</span><span class="p">(</span>
            <span class="nf">createNetworkRequest</span><span class="p">(</span><span class="nc">NetworkCapabilities</span><span class="p">.</span><span class="nc">TRANSPORT_CELLULAR</span><span class="p">),</span>
            <span class="n">cellularNetworkCallback</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Cellular Callback을 해제하는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">unRegisterCellular</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">unregisterNetworkCallback</span><span class="p">(</span><span class="n">cellularNetworkCallback</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1">// Default Network Callback을 등록하는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">registerDefaultNetwork</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">registerDefaultNetworkCallback</span><span class="p">(</span><span class="n">defaultNetworkCallback</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Default Network Callback을 해제하는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">unRegisterDefaultNetwork</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">manager</span><span class="o">?.</span><span class="nf">unregisterNetworkCallback</span><span class="p">(</span><span class="n">defaultNetworkCallback</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Default Network를 제외한 사용 가능한 다른 Network를 등록하는 함수 (여기서는 WIFI, CELLULAR)</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">createNetworkRequest</span><span class="p">(</span><span class="n">capability</span><span class="p">:</span> <span class="nc">Int</span><span class="p">):</span> <span class="nc">NetworkRequest</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">NetworkRequest</span><span class="p">.</span><span class="nc">Builder</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">addTransportType</span><span class="p">(</span><span class="n">capability</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// 모바일 데이터 차단 시 차단 해제로 바꿔주는 함수 입니다.</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">changeUseMobileDataState</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">useMobileData</span> <span class="p">=</span> <span class="n">dataStore</span><span class="p">.</span><span class="n">getUserMobileData</span><span class="p">.</span><span class="nf">first</span><span class="p">()</span>
        <span class="n">dataStore</span><span class="p">.</span><span class="nf">putUseMobileData</span><span class="p">(!</span><span class="n">useMobileData</span><span class="p">)</span>
        <span class="nf">changeNetworkStatus</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// 새로고침 버튼 클릭 함수 입니다.</span>
    <span class="k">fun</span> <span class="nf">onReTryClick</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">networkStatus</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 네트워크가 끊겼거나 Error인 경우</span>
            <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">DISCONNECT_NETWORK</span><span class="p">,</span>
            <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_ERROR</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="n">_networkAction</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1">// 모바일 데이터에 연결은 되었으나 모바일 데이터를 차단한 경우</span>
            <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_NETWORK_BUT_NOT_USE_MOBILE_DATA</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">changeUseMobileDataState</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="c1">// 네트워크가 연결되었을 경우</span>
            <span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_NETWORK</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="n">_networkAction</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="2-networkfragment"><span class="mr-2">2. NetworkFragment</span><a href="#2-networkfragment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>저는 네트워크 연결이 끊겼으면 NetworkFragment를 띄워주는 식으로 하였습니다.</p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
</pre><td class="rouge-code"><pre><span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span> <span class="nc">NetworkFragment</span> <span class="p">:</span> <span class="nc">DialogFragment</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">FragmentNetworkBinding</span>

    <span class="c1">// navigation safe args 사용</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">args</span><span class="p">:</span> <span class="nc">NetworkFragmentArgs</span> <span class="k">by</span> <span class="nf">navArgs</span><span class="p">()</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">viewModel</span><span class="p">:</span> <span class="nc">NetworkViewModel</span> <span class="k">by</span> <span class="nf">activityViewModels</span><span class="p">()</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreateView</span><span class="p">(</span>
        <span class="n">inflater</span><span class="p">:</span> <span class="nc">LayoutInflater</span><span class="p">,</span>
        <span class="n">container</span><span class="p">:</span> <span class="nc">ViewGroup</span><span class="p">?,</span>
        <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?</span>
    <span class="p">):</span> <span class="nc">View</span><span class="p">?</span> <span class="p">{</span>
        <span class="n">binding</span> <span class="p">=</span> <span class="nc">DataBindingUtil</span><span class="p">.</span><span class="nf">inflate</span><span class="p">(</span><span class="n">inflater</span><span class="p">,</span> <span class="n">layoutResId</span><span class="p">,</span> <span class="n">container</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">lifecycleOwner</span> <span class="p">=</span> <span class="n">viewLifecycleOwner</span>
        <span class="k">return</span> <span class="n">binding</span><span class="p">.</span><span class="n">root</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="nc">View</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onViewCreated</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">savedInstanceState</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">viewModel</span> <span class="p">=</span> <span class="n">viewModel</span>
        <span class="n">viewModel</span><span class="p">.</span><span class="n">networkStatus</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">args</span><span class="p">.</span><span class="n">networkState</span>

        <span class="nf">networkViewModelCallback</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">networkViewModelCallback</span><span class="p">()</span> <span class="p">=</span> <span class="nf">with</span><span class="p">(</span><span class="n">viewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentNetworkStatus</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="n">viewLifecycleOwner</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">when</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 네트워크가 연결되면 NetworFragment 지워줌 </span>
                <span class="nc">NetworkViewModel</span><span class="p">.</span><span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_NETWORK</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nf">findNavController</span><span class="p">().</span><span class="nf">popBackStack</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// "새로고침" 눌렀을 경우</span>
        <span class="n">viewLifecycleOwner</span><span class="p">.</span><span class="n">lifecycleScope</span><span class="p">.</span><span class="nf">launchWhenStarted</span> <span class="p">{</span>
            <span class="n">networkAction</span><span class="p">.</span><span class="nf">collect</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 네트워크가 연결되었을 경우</span>
                <span class="nf">findNavController</span><span class="p">().</span><span class="nf">popBackStack</span><span class="p">()</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// 네트워크가 연결되지 않았을 경우</span>
                <span class="nf">showSnackBar</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">,</span> <span class="nf">getString</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">disabled_network</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onStart</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onStart</span><span class="p">()</span>
        <span class="kd">val</span> <span class="py">d</span> <span class="p">=</span> <span class="n">dialog</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">activity</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="nc">IntroActivity</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// intro 화면에서 Dialog 를 Cancel 했을 경우</span>
                    <span class="n">d</span><span class="p">.</span><span class="nf">setOnCancelListener</span> <span class="p">{</span>
                        <span class="nf">requireActivity</span><span class="p">().</span><span class="nf">finish</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">isCancelable</span> <span class="p">=</span> <span class="k">false</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">is</span> <span class="nc">MainActivity</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>

                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">isCancelable</span> <span class="p">=</span> <span class="k">false</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onResume</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onResume</span><span class="p">()</span>
        <span class="n">dialog</span><span class="o">?.</span><span class="n">window</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">window</span> <span class="p">-&gt;</span>
            <span class="n">window</span><span class="p">.</span><span class="nf">setBackgroundDrawableResource</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="nc">R</span><span class="p">.</span><span class="n">color</span><span class="p">.</span><span class="n">transparent</span><span class="p">)</span>
            <span class="n">window</span><span class="p">.</span><span class="nf">clearFlags</span><span class="p">(</span><span class="nc">WindowManager</span><span class="p">.</span><span class="nc">LayoutParams</span><span class="p">.</span><span class="nc">FLAG_DIM_BEHIND</span><span class="p">)</span> <span class="c1">// 기본 배경 제거</span>
            <span class="kd">val</span> <span class="py">params</span> <span class="p">=</span> <span class="n">window</span><span class="p">.</span><span class="n">attributes</span>
            <span class="n">params</span><span class="p">.</span><span class="n">width</span> <span class="p">=</span> <span class="nc">WindowManager</span><span class="p">.</span><span class="nc">LayoutParams</span><span class="p">.</span><span class="nc">MATCH_PARENT</span>
            <span class="n">params</span><span class="p">.</span><span class="n">height</span> <span class="p">=</span> <span class="nc">WindowManager</span><span class="p">.</span><span class="nc">LayoutParams</span><span class="p">.</span><span class="nc">MATCH_PARENT</span>
            <span class="n">window</span><span class="p">.</span><span class="n">attributes</span> <span class="p">=</span> <span class="n">params</span>
            <span class="nf">setTransparentStatusBar</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="3-networffragment-navigation-graph"><span class="mr-2">3. NetworfFragment Navigation Graph</span><a href="#3-networffragment-navigation-graph" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nt">&lt;dialog</span>
        <span class="na">android:id=</span><span class="s">"@+id/networkFragment"</span>
        <span class="na">android:name=</span><span class="s">"com.example.networtest.view.fragment.network.NetworkFragment"</span>
        <span class="na">android:label=</span><span class="s">"NetworkFragment"</span>
        <span class="na">tools:layout=</span><span class="s">"@layout/fragment_network"</span><span class="nt">&gt;</span>

        <span class="c">&lt;!-- Safe Args 사용 --&gt;</span>
        <span class="nt">&lt;argument</span>
            <span class="na">android:name=</span><span class="s">"networkState"</span>
            <span class="na">android:defaultValue=</span><span class="s">"CONNECT_ERROR"</span>
            <span class="na">app:argType=</span><span class="s">"com.example.networtest.view.fragment.network.NetworkViewModel$NetworkStatus"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/dialog&gt;</span>

<span class="c">&lt;!-- 네트워크는 언제 어디서든 끊길 수 있기 때문에 전역에서 사용 --&gt;</span>
<span class="nt">&lt;action</span>
    <span class="na">android:id=</span><span class="s">"@+id/action_global_networkFragment"</span>
    <span class="na">app:destination=</span><span class="s">"@id/networkFragment"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><h2 id="4-networkfragment-xml-정의-rlayoutfragment_network"><span class="mr-2">4. NetworkFragment xml 정의 (R.layout.fragment_network)</span><a href="#4-networkfragment-xml-정의-rlayoutfragment_network" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;layout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;import</span> <span class="na">type=</span><span class="s">"com.example.networtest.view.fragment.network.NetworkViewModel.NetworkStatus"</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">"viewModel"</span>
            <span class="na">type=</span><span class="s">"com.example.networtest.view.fragment.network.NetworkViewModel"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/data&gt;</span>

    <span class="nt">&lt;FrameLayout</span>
        <span class="na">android:id=</span><span class="s">"@+id/network_fl"</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
        <span class="na">android:background=</span><span class="s">"#55000000"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;FrameLayout</span>
            <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
            <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
            <span class="na">android:background=</span><span class="s">"@color/colorTranslucentDim"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;LinearLayout</span>
                <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                <span class="na">android:layout_marginTop=</span><span class="s">"200dp"</span>
                <span class="na">android:orientation=</span><span class="s">"vertical"</span>
                <span class="na">android:paddingStart=</span><span class="s">"20dp"</span>
                <span class="na">android:paddingEnd=</span><span class="s">"20dp"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;ImageView</span>
                    <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                    <span class="na">android:src=</span><span class="s">"@drawable/search_none_w"</span> <span class="nt">/&gt;</span>
                
                <span class="c">&lt;!-- 네트워크가 끊겼을 경우 "연결이 원활하지 않습니다.\n네트워크 연결 상태를 확인하거나\n다시 시도해 주세요." 를 보여줌 --&gt;</span>
                <span class="c">&lt;!-- 나머지 경우 즉, Cellular 차단의 경우 "모바일데이터 차단 상태입니다.\n차단을 해제하거나\nWi-Fi를 설정해 주세요." 를 보여줌 --&gt;</span>
                <span class="nt">&lt;TextView</span>
                    <span class="na">android:id=</span><span class="s">"@+id/network_tv"</span>
                    <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
                    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_marginTop=</span><span class="s">"15.8dp"</span>
                    <span class="na">android:layout_marginBottom=</span><span class="s">"17.2dp"</span>
                    <span class="na">android:gravity=</span><span class="s">"center"</span>
                    <span class="na">android:letterSpacing=</span><span class="s">"-0.02"</span>
                    <span class="na">android:lineHeight=</span><span class="s">"20sp"</span>
                    <span class="na">android:lineSpacingExtra=</span><span class="s">"6sp"</span>
                    <span class="na">android:lineSpacingMultiplier=</span><span class="s">"1.2"</span>
                    <span class="na">android:text=</span><span class="s">"@{viewModel.networkStatus == NetworkStatus.DISCONNECT_NETWORK ? @string/retry_disabled_network : @string/use_mobile_data}"</span>
                    <span class="na">android:textAlignment=</span><span class="s">"center"</span>
                    <span class="na">android:textColor=</span><span class="s">"@android:color/white"</span>
                    <span class="na">android:textSize=</span><span class="s">"14sp"</span> <span class="nt">/&gt;</span>

                <span class="nt">&lt;LinearLayout</span>
                    <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                    <span class="na">android:layout_gravity=</span><span class="s">"center_horizontal"</span>
                    <span class="na">android:orientation=</span><span class="s">"horizontal"</span><span class="nt">&gt;</span>

                    <span class="c">&lt;!-- 네트워크가 끊겼을 경우 "새로고침" 보여줌 --&gt;</span>
                    <span class="c">&lt;!-- 모바일 데이터가 차단되었을 경우 "차단해제" 보여줌 --&gt;</span>
                    <span class="nt">&lt;Button</span>
                        <span class="na">android:id=</span><span class="s">"@+id/retry_btn"</span>
                        <span class="na">style=</span><span class="s">"?android:attr/borderlessButtonStyle"</span>
                        <span class="na">android:layout_width=</span><span class="s">"89dp"</span>
                        <span class="na">android:layout_height=</span><span class="s">"40dp"</span>
                        <span class="na">android:layout_marginStart=</span><span class="s">"4dp"</span>
                        <span class="na">android:layout_marginEnd=</span><span class="s">"4dp"</span>
                        <span class="na">android:background=</span><span class="s">"@drawable/positive_bg3"</span>
                        <span class="na">android:letterSpacing=</span><span class="s">"-0.02"</span>
                        <span class="na">android:lineSpacingExtra=</span><span class="s">"-4sp"</span>
                        <span class="na">android:textColor=</span><span class="s">"#ffffff"</span>
                        <span class="na">android:textSize=</span><span class="s">"14sp"</span>
                        <span class="na">android:text=</span><span class="s">"@{viewModel.networkStatus == NetworkStatus.DISCONNECT_NETWORK ? @string/retry : @string/block_off }"</span>
                        <span class="na">android:onClick=</span><span class="s">"@{() -&gt; viewModel.onReTryClick()}"</span>
                        <span class="na">tools:text=</span><span class="s">"@string/retry"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/LinearLayout&gt;</span>
            <span class="nt">&lt;/LinearLayout&gt;</span>
        <span class="nt">&lt;/FrameLayout&gt;</span>
    <span class="nt">&lt;/FrameLayout&gt;</span>
<span class="nt">&lt;/layout&gt;</span>
</pre></table></code></div></div><h2 id="5-networkviewmodel-연결"><span class="mr-2">5. NetworkViewModel 연결</span><a href="#5-networkviewmodel-연결" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre><td class="rouge-code"><pre><span class="nd">@AndroidEntryPoint</span>
<span class="kd">class</span> <span class="nc">MainActivity</span> <span class="p">:</span> <span class="nc">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">binding</span><span class="p">:</span> <span class="nc">ActivityMainBinding</span> 
    <span class="k">private</span> <span class="kd">val</span> <span class="py">mainViewModel</span><span class="p">:</span> <span class="nc">MainViewModel</span> <span class="k">by</span> <span class="nf">viewModels</span><span class="p">()</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">networkViewModel</span><span class="p">:</span> <span class="nc">NetworkViewModel</span> <span class="k">by</span> <span class="nf">viewModels</span><span class="p">()</span>

    <span class="k">private</span> <span class="k">lateinit</span> <span class="kd">var</span> <span class="py">navController</span><span class="p">:</span> <span class="nc">NavController</span>

    <span class="kd">val</span> <span class="py">navHostFragment</span> <span class="k">by</span> <span class="nf">lazy</span> <span class="p">{</span>
        <span class="n">supportFragmentManager</span><span class="p">.</span><span class="nf">findFragmentById</span><span class="p">(</span><span class="nc">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">navHostFragmentContainer</span><span class="p">)</span> <span class="k">as</span> <span class="nc">NavHostFragment</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">saveInstanceState</span><span class="p">:</span> <span class="nc">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="n">binding</span> <span class="p">=</span> <span class="nc">DataBindingUtil</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nc">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">activity_main</span><span class="p">)</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">lifecycleOwner</span> <span class="p">=</span> <span class="k">this</span>
        <span class="n">binding</span><span class="p">.</span><span class="n">viewModel</span> <span class="p">=</span> <span class="n">mainViewModel</span>

        <span class="n">navController</span> <span class="p">=</span> <span class="n">navHostFragment</span><span class="p">.</span><span class="n">navController</span>

        <span class="c1">// Network Callback 등록</span>
        <span class="n">networkViewModel</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="n">checkNetworkStatus</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>

        <span class="nf">initMainViewModelCallback</span><span class="p">()</span>
        <span class="nf">initNetworkViewModelCallback</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initMainViewModelCallback</span><span class="p">()</span> <span class="p">=</span> <span class="nf">with</span><span class="p">(</span><span class="n">mainViewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">isMobileDataOk</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="n">viewLifecycleOwner</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// isModileDataOk 의 값이 변결될 때 마다 networkViewModel 의 changeNetworkStatus() 함수 호출</span>
            <span class="n">networkViewModel</span><span class="p">.</span><span class="nf">changeNetworkStatus</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initNetworkViewModelCallback</span><span class="p">()</span> <span class="p">=</span> <span class="nf">with</span><span class="p">(</span><span class="n">networkViewModel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentNetworkStatus</span><span class="p">.</span><span class="nf">observe</span><span class="p">(</span><span class="k">this</span><span class="nd">@MainActivity</span><span class="p">)</span> <span class="p">{</span> <span class="n">it</span><span class="p">:</span> <span class="nc">NetworkViewModel</span><span class="p">.</span><span class="nc">NetworkState</span><span class="p">!</span>
            <span class="k">when</span> <span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
                <span class="nc">NetworkViewModel</span><span class="p">.</span><span class="nc">NetworkStatus</span><span class="p">.</span><span class="nc">CONNECT_NETWORK</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="c1">// TODO: 네트워크가 연결되었을 때 동작 넣기</span>
                <span class="p">}</span>
                <span class="c1">// 네트워크 차단 및 Error, Disconnect 의 경우 NetworkFragment 보여줌(현재 Network상태를 NetworFragment 에 넣어줍니다.)</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="n">navController</span><span class="p">.</span><span class="nf">navigate</span><span class="p">(</span>
                        <span class="nc">NavigationDirections</span><span class="p">.</span><span class="nf">actionGlobalNetworkFragment</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// Activity가 onDestory() 될 때 Network Callback 해제</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onDestroy</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">networkViewModel</span><span class="p">.</span><span class="nf">unRegister</span><span class="p">()</span>
        <span class="k">super</span><span class="p">.</span><span class="nf">onDestroy</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="5-mainviewmodel-정의-모바일데이터-차단해제-기능"><span class="mr-2">5. MainViewModel 정의 (모바일데이터 차단/해제 기능)</span><a href="#5-mainviewmodel-정의-모바일데이터-차단해제-기능" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nd">@HiltViewModel</span>
<span class="kd">class</span> <span class="nc">MainViewModel</span> <span class="nd">@Inject</span> <span class="k">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">dataStore</span><span class="p">:</span> <span class="nc">DataStoreModule</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">ViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// DataStore 의 flow 값을 LiveData로 변경</span>
    <span class="kd">val</span> <span class="py">isMobileDataOk</span><span class="p">:</span> <span class="nc">LiveData</span><span class="p">&lt;</span><span class="nc">Boolean</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">liveData</span> <span class="p">{</span>
        <span class="n">dataStore</span><span class="p">.</span><span class="n">getUserMobileData</span><span class="p">.</span><span class="nf">collect</span> <span class="p">{</span>
            <span class="nf">emit</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 모바일 데이터 차단/해제 클릭 Listener</span>
    <span class="k">fun</span> <span class="nf">onMobileClick</span><span class="p">()</span> <span class="p">=</span> <span class="n">viewModelScope</span><span class="p">.</span><span class="nf">launch</span> <span class="p">{</span>
        <span class="c1">// 누를때마다 isMobileDataOk 의 반대값을 넣어줌</span>
        <span class="n">dataStore</span><span class="p">.</span><span class="nf">putUseMobileData</span><span class="p">(!</span><span class="n">isMobileDataOk</span><span class="p">.</span><span class="n">value</span><span class="o">!!</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="6-mainactivity-xml-정의-rlayoutactivity_main"><span class="mr-2">6. MainActivity xml 정의 (R.layout.activity_main)</span><a href="#6-mainactivity-xml-정의-rlayoutactivity_main" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre><td class="rouge-code"><pre><span class="nt">&lt;layout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
    <span class="na">xmlns:app=</span><span class="s">"http://schemas.android.com/apk/res-auto"</span>
    <span class="na">xmlns:tools=</span><span class="s">"http://schemas.android.com/tools"</span>
    <span class="na">tools:context=</span><span class="s">".activity.main.MainActivity"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">"viewModel"</span>
            <span class="na">type=</span><span class="s">"com.example.networtest.view.activity.main.MainViewModel"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/data&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span>
        <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
        <span class="na">android:layout_height=</span><span class="s">"match_parent"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;androidx.fragment.app.FragmentContainerView</span>
            <span class="na">android:id=</span><span class="s">"@+id/navHostFragmentContainer"</span>
            <span class="na">android:name=</span><span class="s">"androidx.navigation.fragment.NavHostFragment"</span>
            <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
            <span class="na">android:layout_height=</span><span class="s">"0dp"</span>
            <span class="na">app:defaultNavHost=</span><span class="s">"true"</span>
            <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
            <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
            <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span>
            <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">"parent"</span>
            <span class="na">app:navGraph=</span><span class="s">"@navigation/navigation"</span> <span class="nt">/&gt;</span>
            
            <span class="c">&lt;!-- isMobileDataOk 가 true 이면 "차단", false 이면 "차단해제" 보여줌 --&gt;</span>
            <span class="nt">&lt;Button</span>
                <span class="na">android:layout_width=</span><span class="s">"0dp"</span>
                <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
                <span class="na">android:text=</span><span class="s">"@{viewModel.isMobileDataOk ? @string/block : @string/block_off}"</span>
                <span class="na">android:onClick=</span><span class="s">"@{() -&gt; viewModel.onMobileClick()}"</span>
                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">"parent"</span>
                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">"parent"</span>
                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">"parent"</span> <span class="nt">/&gt;</span> 
    <span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
<span class="nt">&lt;/layout&gt;</span>
</pre></table></code></div></div><h2 id="7-모바일-데이터-차단-유무를-저장을-위한-datastore-정의"><span class="mr-2">7. 모바일 데이터 차단 유무를 저장을 위한 DataStore 정의</span><a href="#7-모바일-데이터-차단-유무를-저장을-위한-datastore-정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>DataStore에 대하여 자세히 알고싶으시면 해당 링크를 참고하세요. -&gt; <a href="https://narvis2.github.io/posts/Android-DataStore/">DataStore 정리</a></p><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">DataStoreModule</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">context</span><span class="p">:</span> <span class="nc">Context</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// DataStore 인스턴스 생성</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">Context</span><span class="p">.</span><span class="n">dataStore</span> <span class="k">by</span> <span class="nf">preferencesDataStore</span><span class="p">(</span><span class="n">name</span> <span class="p">=</span> <span class="s">"test.db"</span><span class="p">)</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">mobileDataKey</span> <span class="p">=</span> <span class="nf">booleanPreferencesKey</span><span class="p">(</span><span class="s">"use_mobile_data"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">getUserMobileData</span><span class="p">:</span> <span class="nc">Flow</span><span class="p">&lt;</span><span class="nc">Boolean</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">dataStore</span><span class="p">.</span><span class="n">data</span>
        <span class="p">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">exception</span> <span class="p">-&gt;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">exception</span> <span class="k">is</span> <span class="nc">IOException</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">emit</span><span class="p">(</span><span class="nf">emptyPreferences</span><span class="p">())</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="n">exception</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">preferences</span> <span class="p">-&gt;</span>
            <span class="n">preferences</span><span class="p">[</span><span class="n">mobileDataKey</span><span class="p">]</span> <span class="o">?:</span> <span class="k">false</span>
        <span class="p">}</span>

    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">putUseMobileData</span><span class="p">(</span><span class="n">use</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">getData</span> <span class="p">=</span> <span class="n">getUserMobileData</span><span class="p">.</span><span class="nf">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">getData</span> <span class="p">!=</span> <span class="n">use</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">context</span><span class="p">.</span><span class="n">dataStore</span><span class="p">.</span><span class="nf">edit</span> <span class="p">{</span> <span class="n">preferences</span> <span class="p">-&gt;</span>
                <span class="n">preferences</span><span class="p">[</span><span class="n">mobileDataKey</span><span class="p">]</span> <span class="p">=</span> <span class="n">use</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="8-datastore-hilt-module-정의"><span class="mr-2">8. DataStore Hilt Module 정의</span><a href="#8-datastore-hilt-module-정의" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-kotlin highlighter-rouge"><div class="code-header"> <span data-label-text="Kotlin"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="복사되었습니다!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Module</span>
<span class="nd">@InstallIn</span><span class="p">(</span><span class="nc">SingletonComponent</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">object</span> <span class="nc">LocalDataModule</span> <span class="p">{</span>

    <span class="nd">@Singleton</span>
    <span class="nd">@Provides</span>
    <span class="k">fun</span> <span class="nf">provideDataStoreModule</span><span class="p">(</span><span class="nd">@ApplicationContext</span> <span class="n">context</span><span class="p">:</span> <span class="nc">Context</span><span class="p">):</span> <span class="nc">DataStoreModule</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nc">DataStoreModule</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="마무리"><span class="mr-2">마무리</span><a href="#마무리" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>이번 포스팅에서는 Android ConnectivityManager 를 통한 Network 관리에 대하여 코드를 위주로 알아보았습니다.<br /> 해당 코드에서는 Default Network, Wifi, Cellular 상태를 관리하며, Cellular 차단 기능 또한 들어있습니다.<br /> Network 의 연결이 끊겼을 시 NetworkFragment를 띄워주며 네트워크 끊김, Cellular는 연결되어 있지만 Cellular를 차단한 경우에 따라 UI를 분리하고 있습니다.<br /> 또한 버튼을 클릭 시 모바일 데이터를 차단/해제 하는 코드 또한 존재합니다.<br /> 다음 시간에는 위에서 사용중인 Flow 및 StateFlow, Coroutine Channel 에 대하여 자세히 알아보도록 하겠습니다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/android/'>Android</a>, <a href='/categories/network/'>Network</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/android/" class="post-tag no-text-decoration" >android</a> <a href="/tags/network/" class="post-tag no-text-decoration" >network</a> <a href="/tags/connectivity-manager/" class="post-tag no-text-decoration" >connectivity manager</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 이 기사는 저작권자의 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 라이센스를 따릅니다.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">공유하기</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Android+ConnectivityManager%EB%A5%BC+%ED%86%B5%ED%95%9C+Network+%EA%B4%80%EB%A6%AC+-+Narvis2&url=https%3A%2F%2Fnarvis2.github.io%2Fposts%2FAndroid-Network%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Android+ConnectivityManager%EB%A5%BC+%ED%86%B5%ED%95%9C+Network+%EA%B4%80%EB%A6%AC+-+Narvis2&u=https%3A%2F%2Fnarvis2.github.io%2Fposts%2FAndroid-Network%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fnarvis2.github.io%2Fposts%2FAndroid-Network%2F&text=Android+ConnectivityManager%EB%A5%BC+%ED%86%B5%ED%95%9C+Network+%EA%B4%80%EB%A6%AC+-+Narvis2" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="링크 복사하기" data-title-succeed="링크가 복사되었습니다!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">최근 업데이트</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/iOS-SwiftUi-ViewModel/">iOS SwiftUi ViewModel</a><li><a href="/posts/Android-Activity-Lifecycle/">Android Activity Lifecycle 생명주기 정리</a><li><a href="/posts/Javascript-Promise-Async-Await/">JavaScript 비동기 작업 Promise, async, await 알아보기</a><li><a href="/posts/iOS-Swift-Alamofire/">iOS SwiftUi Alamofire 기초</a><li><a href="/posts/iOS-Swift-Combine-Basic/">iOS SwiftUi Combine 기초</a></ul></div><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/react-native/">react-native</a> <a class="post-tag" href="/tags/compose/">compose</a> <a class="post-tag" href="/tags/jetpack/">jetpack</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/redux/">redux</a> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/uikit/">UIKit</a> <a class="post-tag" href="/tags/coroutine/">coroutine</a> <a class="post-tag" href="/tags/class/">class</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">바로가기</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>관련된 글</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Android-Activity-Lifecycle/"><div class="card-body"> <em class="small" data-ts="1657672080" data-df="YYYY-MM-DD" > 2022-07-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android Activity Lifecycle 생명주기 정리</h3><div class="text-muted small"><p> Android Activity Lifecycle 동작 순서 구글 공식 홈페이지에 나와있는 이미지를 참고하시면 이해가 쉽습니다. 해당 이미지를 참고하여 Activity Lifecycle 의 순서를 보면 Activity 생성 시 onCreate() -&amp;gt; onStart() -&amp;gt; onResume() 의 순서로 콜백이 실행 되며 Activity...</p></div></div></a></div><div class="card"> <a href="/posts/Android-Fragment-Lifecycle/"><div class="card-body"> <em class="small" data-ts="1657672080" data-df="YYYY-MM-DD" > 2022-07-13 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android Fragment Lifecycle 생명주기 정리</h3><div class="text-muted small"><p> 이전 Activity Lifecycle 정리 포스팅에 이어 이번에는 Fragment 의 Lifecycle에 대해 알아보겠습니다. 🚩 Android Fragment Lifecycle 동작 순서 이번에도 구글 공식 홈페이지에 나와있는 이미지를 바탕으로 살펴보겠습니다. 해당 이미지를 참고하여 Fragment Lifecycle 의 순서를 보면 Fragme...</p></div></div></a></div><div class="card"> <a href="/posts/Android-handler-looper/"><div class="card-body"> <em class="small" data-ts="1657766640" data-df="YYYY-MM-DD" > 2022-07-14 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Android Handler, Looper 에 관하여</h3><div class="text-muted small"><p> 이번에는 Handler, Looper 에 대해서 알아보도록 하겠습니다. Android의 UI 처리는 Single Thread Model로 동작합니다. 즉, mainThread가 아닌 다른 Thread에서 UI 를 Update하는 등의 행위를 하면 안됩니다. 따라서 mainThread를 UI Thread라고 부르기도 합니다. 동작의 무결성을 보장하기 위...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Android-DataStore/" class="btn btn-outline-primary" prompt="이전 글"><p>Android DataStore(SharedPreference 대체)</p></a> <a href="/posts/Android-Coroutine/" class="btn btn-outline-primary" prompt="다음 글"><p>Android Coroutine</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/narvis2">narvis2</a>. <span data-toggle="tooltip" data-placement="top" title="명시되지 않는 한 이 사이트의 블로그 게시물은 작성자의 Creative Commons Attribution 4.0 International(CC BY 4.0) 라이선스에 따라 사용이 허가되었습니다.">일부 권리 보유</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">인기 태그</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/android/">android</a> <a class="post-tag" href="/tags/react-native/">react-native</a> <a class="post-tag" href="/tags/compose/">compose</a> <a class="post-tag" href="/tags/jetpack/">jetpack</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/redux/">redux</a> <a class="post-tag" href="/tags/typescript/">typescript</a> <a class="post-tag" href="/tags/uikit/">UIKit</a> <a class="post-tag" href="/tags/coroutine/">coroutine</a> <a class="post-tag" href="/tags/class/">class</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">새 버전의 콘텐츠를 사용할 수 있습니다.</p><button type="button" class="btn btn-primary" aria-label="Update"> 업데이트 </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">검색 결과가 없습니다.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/ko.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
